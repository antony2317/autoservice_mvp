{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'services/css/index.css' %}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <h1>{{ service.name }}</h1>
        <p class="lead">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–º–æ–Ω—Ç –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤—Å–µ—Ö –º–∞—Ä–æ–∫</p>

        {% if not is_user %}
            <button id="callBtn" class="btn btn-primary">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>

            <div id="phoneContainer" class="phone-container" style="display:none;">
                <a href="tel:{{ service.phone|default:'+79991234567' }}" class="phone-link" style="color: white;">
                    üìû {{ service.phone|default:"+7 (999) 123-45-67" }}
                </a>
            </div>
        {% endif %}
    </div>
</section>

{% if is_user %}
<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å–ª—É–≥–∏ -->
<section class="add-service-section py-4">
    <div class="container">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —É—Å–ª—É–≥—É</h2>
        <form method="post">
            {% csrf_token %}
            {{ service_form.non_field_errors }}
            <div class="form-group mb-3">
                {{ service_form.name.label_tag }}<br>
                {{ service_form.name }}
                {{ service_form.name.errors }}
            </div>
            <div class="form-group mb-3">
                {{ service_form.description.label_tag }}<br>
                {{ service_form.description }}
                {{ service_form.description.errors }}
            </div>
            <div class="form-group mb-3">
                {{ service_form.price.label_tag }}<br>
                {{ service_form.price }}
                {{ service_form.price.errors }}
            </div>
            <button type="submit" name="add_service" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
        </form>
    </div>
</section>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞ -->
<section class="add-master-section py-4 bg-light">
    <div class="container">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞</h2>
        <form method="post">
            {% csrf_token %}
            {{ master_form.non_field_errors }}
            <div class="form-group mb-3">
                {{ master_form.name.label_tag }}<br>
                {{ master_form.name }}
                {{ master_form.name.errors }}
            </div>
            <div class="form-group mb-3">
                {{ master_form.specialization.label_tag }}<br>
                {{ master_form.specialization }}
                {{ master_form.specialization.errors }}
            </div>
            <div class="form-group mb-3">
                {{ master_form.experience.label_tag }}<br>
                {{ master_form.experience }}
                {{ master_form.experience.errors }}
            </div>
            <button type="submit" name="add_master" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞</button>
        </form>
    </div>
</section>
{% endif %}

<!-- –°–µ–∫—Ü–∏—è —Å —É—Å–ª—É–≥–∞–º–∏ -->
<section class="services-section py-5">
    <div class="container">
        <h2 class="section-title toggle-button" onclick="toggleServices()" style="cursor:pointer;">
            –£—Å–ª—É–≥–∏ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ <span id="arrow">‚ñº</span>
        </h2>

        <div id="servicesContainer" class="services-grid collapsed">
            {% for item in services %}
            <div class="service-card p-3 mb-3 border rounded">
                <h3>{{ item.name }}</h3>
                <p class="price">–æ—Ç {{ item.price }} —Ä—É–±.</p>

                {% if request.user == item.autoservice.user %}
                    <div class="service-actions">
                        <a href="{% url 'services:edit_service' item.pk %}" class="btn btn-outline-primary btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <form action="{% url 'services:delete_service' item.pk %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É?')">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </div>
                {% endif %}
            </div>
            {% empty %}
            <p>–£—Å–ª—É–≥–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- –û —Å–µ—Ä–≤–∏—Å–µ -->
<section class="about-section py-5 bg-secondary text-white">
    <div class="container text-center">
        <h2 class="about-title">–û –Ω–∞—à–µ–º —Å–µ—Ä–≤–∏—Å–µ</h2>
        <p class="about-description">
            –ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞ —Ä—ã–Ω–∫–µ –∞–≤—Ç–æ—É—Å–ª—É–≥ –±–æ–ª–µ–µ 10 –ª–µ—Ç. –ù–∞—à–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã –∏–º–µ—é—Ç –±–æ–ª—å—à–æ–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã —Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Ä–æ–∫ –∏ –º–æ–¥–µ–ª–µ–π.
        </p>
        <ul class="about-features list-unstyled d-flex justify-content-center gap-4">
            <li><i class="fas fa-tools"></i> –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</li>
            <li><i class="fas fa-cogs"></i> –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–∞–ø—á–∞—Å—Ç–∏</li>
            <li><i class="fas fa-shield-alt"></i> –ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞ —Ä–∞–±–æ—Ç—ã</li>
        </ul>
    </div>
</section>

<!-- –°–µ–∫—Ü–∏—è —Å –º–∞—Å—Ç–µ—Ä–∞–º–∏ -->
<section class="masters-section py-5">
    <div class="container">
        <h2 class="text-center mb-5">–ù–∞—à–∏ –º–∞—Å—Ç–µ—Ä–∞</h2>

        <div class="row">
            {% for master in masters %}
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card text-white text-center h-100 p-3"
                     style="background-color: {% cycle '#6c5ce7' '#00cec9' '#fd79a8' '#fab1a0' %}; border: none;">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <h5 class="card-title mb-2">{{ master.name }}</h5>
                        <p class="card-text mb-1"><strong>{{ master.specialization }}</strong></p>
                        <p class="card-text">–°—Ç–∞–∂: {{ master.experience }} –ª–µ—Ç</p>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="text-center">–ú–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ -->

<!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π CTA -->
<section class="contact-cta">
    <div class="container">
        <h2>–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –Ω–∞—Å –ø–æ –∞–¥—Ä–µ—Å—É: {{ service.address }}</h2>
        <h3>–ù–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã: üìû {{ service.phone|default:"+7 (999) 123-45-67" }}</h3>
    </div>
</section>

<!-- –ö–∞—Ä—Ç–∞ –Ø–Ω–¥–µ–∫—Å -->
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script type="text/javascript">
    ymaps.ready(init);
    function init(){
        var myMap = new ymaps.Map("map", {
            center: [53.902497, 27.561481],
            zoom: 15
        });

        myMap.geoObjects.add(new ymaps.Placemark([53.902496, 27.561481], {
            balloonContent: '–ù–∞—à –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å'
        }));
    }

    function toggleServices() {
        const container = document.getElementById('servicesContainer');
        const arrow = document.getElementById('arrow');

        container.classList.toggle('collapsed');
        arrow.textContent = container.classList.contains('collapsed') ? '‚ñº' : '‚ñ≤';
    }

    document.addEventListener('DOMContentLoaded', function () {
        const callBtn = document.getElementById('callBtn');
        const phoneContainer = document.getElementById('phoneContainer');

        if(callBtn) {
            callBtn.addEventListener('click', function () {
                if (phoneContainer.style.display === 'block') {
                    phoneContainer.style.display = 'none';
                } else {
                    phoneContainer.style.display = 'block';
                }
            });
        }
    });
</script>

<div id="map" style="width: 100%; height: 400px;"></div>
{% endblock %}
