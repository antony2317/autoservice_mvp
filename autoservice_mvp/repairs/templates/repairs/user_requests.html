{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'repairs/css/accepted_responses.css' %}">
{% endblock %}

{% block content %}
<div class="accepted-responses-container">
    <h2>–ü—Ä–∏–Ω—è—Ç—ã–µ –∑–∞—è–≤–∫–∏</h2>

    {% if responses %}
        <div class="responses-list">
            {% for response in responses %}
                <div class="response-card">
                    <div class="response-header">
                        <div class="response-id">–ó–∞—è–≤–∫–∞ #{{ response.repair_request.id }}</div>

                        <!-- –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å -->
                        <div class="response-status">
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> {{ response.repair_request.get_status_display }}
                        </div>
                    </div>

                    <div class="response-body">
                        <p><strong>–ö–ª–∏–µ–Ω—Ç:</strong> {{ response.repair_request.user.username }}</p>
                        <p><strong>–ê–≤—Ç–æ–º–æ–±–∏–ª—å:</strong> {{ response.repair_request.car }}</p>
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ response.repair_request.description }}</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> {{ response.proposed_price }} ‚ÇΩ</p>
                        <p><strong>–î–∞—Ç–∞ —Ä–µ–º–æ–Ω—Ç–∞:</strong> {{ response.proposed_date }}</p>

                        <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞ -->
                        <form method="post" action="{% url 'repairs:change_request_status' response.repair_request.id %}">
                            {% csrf_token %}
                            <div class="form-group mt-3">
                                <label for="status"><strong>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</strong></label>
                                <select name="status" class="form-select" onchange="this.form.submit()">
                                    {% for value, label in status_choices %}
                                        <option value="{{ value }}" {% if response.repair_request.status == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>

                        <div class="chat-button-container mt-3">
                            <a href="{% url 'chat:chat_with_response' request_id=repair_request.id response_id=response.id %}">
                                üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-responses">
            <p>–ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
