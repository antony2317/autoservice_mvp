{% extends 'base.html' %}

{% block content %}
<h2>–ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>

{% for req in repair_requests %}
<div class="request-block">
    <p><strong>–ê–≤—Ç–æ:</strong> {{ req.car }}</p>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ req.description }}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ req.get_status_display }}</p>

    {% if req.responses.all %}
        <h4>–û—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–≤:</h4>
        {% for resp in req.responses.all %}
            <div class="response">
                <p>–°–µ—Ä–≤–∏—Å: {{ resp.service.username }}</p>
                <p>–¶–µ–Ω–∞: {{ resp.proposed_price }}‚ÇΩ</p>
                <p>–î–∞—Ç–∞: {{ resp.proposed_date }}</p>

                {% if not resp.is_accepted %}
                    <form method="post" action="{% url 'repairs:accept_response' resp.id %}">
                        {% csrf_token %}
                        <button type="submit">–ü—Ä–∏–Ω—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
                    </form>
                {% else %}
                    <span class="accepted">‚úÖ –ü—Ä–∏–Ω—è—Ç–æ</span>

                    <!-- –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –≤ —á–∞—Ç -->
                    <a href="{% url 'chat:chat_between_users' req.id %}" class="btn btn-primary mt-2">
                        üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç
                    </a>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</p>
    {% endif %}
</div>
<hr>
{% endfor %}

{% endblock %}