{% extends 'base.html' %}

{% block content %}
<h2>–ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>

{% for req in repair_requests %}
<div class="request-block">
    <p><strong>–ê–≤—Ç–æ:</strong> {{ req.car }}</p>
    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> {{ req.description }}</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ req.get_status_display }}</p>

    {% if req.responses.all %}
        <h4>–û—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–≤:</h4>
        {% for resp in req.responses.all %}
            <div class="response">
                <p><strong>–°–µ—Ä–≤–∏—Å:</strong> {{ resp.service.username }}</p>
                <p><strong>–¶–µ–Ω–∞:</strong> {{ resp.proposed_price }}‚ÇΩ</p>
                <p><strong>–î–∞—Ç–∞:</strong> {{ resp.proposed_date }}</p>

                {% for resp in req.responses.all %}
                    <p>DEBUG: Service ID = {{ resp.service.id }}, Service Username = {{ resp.service.username }}</p>
                    <!-- –ö–Ω–æ–ø–∫–∞ —á–∞—Ç–∞ -->
                    <a href="{% url 'chat_room' request_id=req.id other_user_id=resp.service.id %}"
                       class="btn btn-outline-primary mb-2">
                        üí¨ –ß–∞—Ç —Å {{ resp.service.username }}
                    </a>
                {% endfor %}

                {% if not resp.is_accepted %}
                    <form method="post" action="{% url 'repairs:accept_response' resp.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">–ü—Ä–∏–Ω—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
                    </form>
                {% else %}
                    <span class="accepted">‚úÖ –ü—Ä–∏–Ω—è—Ç–æ</span>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        <p>–ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</p>
    {% endif %}
</div>
<hr>
{% endfor %}
{% endblock %}

