{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'repairs/css/repair_responses.css' %}">
{% endblock %}

{% block content %}
<div class="repair-responses-container repair-responses-py-4">
    <div class="repair-responses-card repair-responses-mb-4">
        <div class="repair-responses-card-header">
            <div class="repair-responses-header-bar repair-responses-flex repair-responses-justify-between repair-responses-align-center">
                <h2>–û—Ç–∫–ª–∏–∫–∏ –Ω–∞ –∑–∞—è–≤–∫—É #{{ repair_request.id }}</h2>
                <a href="{% url 'garage' %}" class="repair-responses-btn repair-responses-btn-light back-btn">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞—è–≤–∫–∞–º
                </a>
            </div>
        </div>

        <div class="repair-responses-card-body">
            <div class="repair-responses-row repair-responses-mb-4">
                <div class="repair-responses-col-md-6">
                    <h5>–ê–≤—Ç–æ–º–æ–±–∏–ª—å</h5>
                    <p>{{ repair_request.car.brand }} {{ repair_request.car.model }}</p>

                    <h5 class="repair-responses-mt-3">–û–ø–∏—Å–∞–Ω–∏–µ</h5>
                    <p>{{ repair_request.description }}</p>
                </div>
                <div class="repair-responses-col-md-6">
                    <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                        <span class="repair-responses-badge repair-responses-bg-{% if repair_request.status == 'new' %}info{% elif repair_request.status == 'in_progress' %}warning{% else %}success{% endif %}">
                            {{ repair_request.get_status_display }}
                        </span>
                    </p>
                    <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> {{ repair_request.created_at|date:"d.m.Y H:i" }}</p>

                    {% if repair_request.has_accepted_response %}
                        <div class="repair-responses-alert repair-responses-alert-success repair-responses-mt-3">
                            –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∏–Ω—è—Ç–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
                        </div>
                    {% endif %}
                </div>
            </div>

            <hr class="repair-responses-hr">

            <h4 class="repair-responses-mb-3">–í—Å–µ –æ—Ç–∫–ª–∏–∫–∏</h4>

            {% if responses %}
                <div class="repair-responses-list-group">
                    {% for response in responses %}
                    <div class="repair-responses-list-group-item {% if response.is_accepted %}repair-responses-list-group-item-success{% elif response.is_rejected %}repair-responses-list-group-item-light{% endif %}">
                        <div class="repair-responses-flex repair-responses-justify-between repair-responses-align-start repair-responses-flex-wrap">
                            <div>
                                <h5 class="repair-responses-mb-1">
                                    <strong>–°–µ—Ä–≤–∏—Å:</strong>
                                    <a href="{% url 'services:service_detail' response.service.autoservice.id %}" class="service-card-link">
                                        {{ response.service.username }}
                                    </a>
                                    {% if response.is_accepted %}
                                        <span class="repair-responses-badge repair-responses-bg-success repair-responses-ms-2">‚úì –ü—Ä–∏–Ω—è—Ç–æ</span>
                                    {% elif response.is_rejected %}
                                        <span class="repair-responses-badge repair-responses-bg-secondary repair-responses-ms-2">√ó –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                                    {% endif %}
                                </h5>
                                <small class="repair-responses-text-muted">
                                    –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ response.created_at|date:"d.m.Y H:i" }}
                                </small>
                            </div>

                            {% if not repair_request.has_accepted_response and not response.is_accepted and not response.is_rejected %}
                            <div class="repair-responses-actions repair-responses-mt-2">
                                <form method="post" action="{% url 'repairs:accept_response' response.id %}" class="repair-responses-d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="repair-responses-btn repair-responses-btn-success">
                                        ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                                    </button>
                                </form>
                                <form method="post" action="{% url 'repairs:reject_response' response.id %}" class="repair-responses-d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="repair-responses-btn repair-responses-btn-outline-danger">
                                        ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                    </button>
                                </form>
                            </div>
                            {% endif %}
                        </div>

                        <div class="repair-responses-row repair-responses-mt-3">
                            <div class="repair-responses-col-md-4">
                                <p><strong>–¶–µ–Ω–∞:</strong>
                                    <span class="repair-responses-text-primary">{{ response.proposed_price }} ‚ÇΩ</span>
                                </p>
                            </div>
                            <div class="repair-responses-col-md-4">
                                <p><strong>–î–∞—Ç–∞:</strong>
                                    {{ response.proposed_date|date:"d.m.Y" }}
                                </p>
                            </div>
                            <div class="repair-responses-col-md-4">
                                <p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong>
                                    {{ response.comment|default:"-" }}
                                </p>
                            </div>
                        </div>

                        <div class="repair-responses-mt-2 repair-responses-text-end">
                            <a href="{% url 'chat:chat_with_response' request_id=repair_request.id response_id=response.id %}"
                               class="repair-responses-chat-button">
                                üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç —Å –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–æ–º
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="repair-responses-alert repair-responses-alert-info">
                    –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤ –Ω–∞ —ç—Ç—É –∑–∞—è–≤–∫—É.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
